---
title: Apollo Studio
---

This guide illustrates how to configure `tailcall` to send usage metrics to [Apollo Studio](https://studio.apollographql.com).<br/><br/>
_Note: Before proceeding make sure you have an Apollo Enterprise account. If not, you can get a free 28 days trial by going [here](https://studio.apollographql.com/signup?type=enterprise-trial)._

## Creating a monolith graph

Before you configure `tailcall`, you will need to create a `Monolith` graph on Apollo Studio.

![home.png](../../static/images/apollo-studio/home.png)

- Go to your organization's home page.
- Click on `Create your first graph`, if this is your first graph or `Create New Graph` if you have existing graphs.

![create-graph.png](../../static/images/apollo-studio/create-graph.png)

- Change the `Graph title`, `Graph ID` and other fields as desired.
- Make sure to change `Graph Architecture` to Monolith, since only Monolith graphs are currently supported by `tailcall`.
- Once you are done, click on `Next`. You'll see the following screen.

![insert-gql-schema.png](../../static/images/apollo-studio/insert-gql-schema.png)

- Copy the fields `APOLLO_KEY` and `APOLLO_GRAPH_REF` as they are required by `tailcall` to be able to send the usage metrics.
- There are two ways to let Apollo know about your GraphQL schema:

  - Navigate to `Local Introspection`. If you have a deployed instance of your GraphQL server you can put the URL pointing to that in `Endpoint URL`. If not, start a local instance of `tailcall` and put the local url here, similar to how is shown in the image below.<br/>
    _Note: You can start a local instance of tailcall by running `tailcall start <path-to-config>`(click [here](./cli.md) to know more)._

  ![local-introspection.png](../../static/images/apollo-studio/local-introspection.png)

  - Or, Navigate to `Local Schema` and insert your schema generated by `tailcall` and click `Upload`.<br/>
    _Note: you can get the schema by running `tailcall check --schema <path-to-config>`_(click [here](./cli.md) to know more).

![local-schema.png](../../static/images/apollo-studio/local-schema.png)

You have now successfully created a Monolith graph in Apollo Studio. The next step is to configure `tailcall` to use the `APOLLO_API_KEY` and `APOLLO_GRAPH_REF`. Follow instructions [here](../operators/telemetry.md).

## Check the metrics in Apollo Studio

To see the metrics for your queries follow these instructions:

- Start `tailcall` with the appropriate configuration for Apollo. Below is an example of what a config may look like.

```graphql
schema
  @server(port: 8000, graphiql: true, hostname: "0.0.0.0")
  @upstream(baseURL: "http://jsonplaceholder.typicode.com")
  @telemetry(
    export: {
      apollo: {
        # Make sure you set the appropriate values for APOLLO_API_KEY and APOLLO_GRAPH_REF
        # in the ENV, as was acquired from the Apollo Studio website.
        api_key: "{{env.APOLLO_API_KEY}}"
        graph_ref: "{{env.APOLLO_GRAPH_REF}}"
      }
    }
  ) {
  query: Query
}

type Query {
  posts: [Post] @http(path: "/posts")
}

type Post {
  id: Int!
  userId: Int!
  title: String!
  body: String!
}
```

- Visit `http://localhost:8000/graphql` and create a query with an appropriate name (below is an example query named `MyQuery`) and run it multiple times to send the metrics to Apollo Studio.<br/>
  _Note: Naming the query is not required to be able to send the metrics, but it helps to organize the metrics with appropriate names when viewed in Apollo Studio._

```graphql
query MyQuery {
  posts {
    id
    title
  }
}
```

- To see the metrics click on the `VARIANT NAME` of your graph. In the example below, the variant name is `current`.

![graph-home.png](../../static/images/apollo-studio/graph-home.png)

- You will see the following page. From here click on insights icon as highlighted on the left side of the image.

![insights-nav.png](../../static/images/apollo-studio/insights-nav.png)

- You will now be able to see all the information related to your queries here

![insights.png](../../static/images/apollo-studio/insights.png)

![insights-graph.png](../../static/images/apollo-studio/insights-graph.png)

_Note: If you don't see the name of your query here, try running the query multiple times and waiting for some time. Since the metric isn't sent to Apollo Studio for each query, instead they are batched together and sent at once for efficiency reasons._
