"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2385],{52921:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var a=n(74848),o=n(28453);const r={title:"Use Tailcall service as a Federation Subgraph",description:"Learn how to configure Tailcall to function as an Apollo Federation Subgraph, enabling seamless integration into a federated GraphQL environment.",slug:"integrate-apollo-federation-graphql-tailcall-subgraph",sidebar_label:"Apollo Federation Subgraph"},i=void 0,l={id:"apollo-federation-subgraph",title:"Use Tailcall service as a Federation Subgraph",description:"Learn how to configure Tailcall to function as an Apollo Federation Subgraph, enabling seamless integration into a federated GraphQL environment.",source:"@site/docs/apollo-federation-subgraph.md",sourceDirName:".",slug:"/integrate-apollo-federation-graphql-tailcall-subgraph",permalink:"/docs/integrate-apollo-federation-graphql-tailcall-subgraph",draft:!1,unlisted:!1,editUrl:"https://github.com/tailcallhq/tailcallhq.github.io/tree/develop/docs/apollo-federation-subgraph.md",tags:[],version:"current",lastUpdatedAt:1729657116e3,frontMatter:{title:"Use Tailcall service as a Federation Subgraph",description:"Learn how to configure Tailcall to function as an Apollo Federation Subgraph, enabling seamless integration into a federated GraphQL environment.",slug:"integrate-apollo-federation-graphql-tailcall-subgraph",sidebar_label:"Apollo Federation Subgraph"},sidebar:"docs",previous:{title:"Auto Generation",permalink:"/docs/graphql-configuration-generation-with-tailcall"},next:{title:"Apollo Studio",permalink:"/docs/integrate-apollo-studio-graphql-tailcall"}},s={},c=[{value:"Create the Tailcall config",id:"create-the-tailcall-config",level:2},{value:"Define Entity Resolvers",id:"define-entity-resolvers",level:2},{value:"Enable federation in the Tailcall config",id:"enable-federation-in-the-tailcall-config",level:2},{value:"Register your subgraph",id:"register-your-subgraph",level:2},{value:"GraphOS Router",id:"graphos-router",level:3},{value:"@apollo/gateway",id:"apollogateway",level:3},{value:"Using federation specific directives",id:"using-federation-specific-directives",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.p,{children:["This guide shows how to configure tailcall to function as an ",(0,a.jsx)(t.a,{href:"https://www.apollographql.com/docs/federation/building-supergraphs/subgraphs-overview/",children:"Apollo Federation Subgraph"})," in your GraphQL infrastructure."]}),"\n",(0,a.jsx)(t.h2,{id:"create-the-tailcall-config",children:"Create the Tailcall config"}),"\n",(0,a.jsxs)(t.p,{children:["First, you need to create a basic Tailcall configuration. For reference, check out our ",(0,a.jsx)(t.a,{href:"/docs/",children:"Getting Started"})," guide."]}),"\n",(0,a.jsx)(t.h2,{id:"define-entity-resolvers",children:"Define Entity Resolvers"}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsx)(t.p,{children:"Skip this step if you don't have entities for now or want to add them later."})}),"\n",(0,a.jsxs)(t.p,{children:["Now you need to add ",(0,a.jsx)(t.a,{href:"https://www.apollographql.com/docs/federation/entities/",children:"entity resolvers"})," to the Tailcall config to make it act as a subgraph."]}),"\n",(0,a.jsxs)(t.p,{children:["To do this, you need to define resolver on types by using one of the ",(0,a.jsx)(t.a,{href:"/docs/tailcall-graphql-configuration-format-conversion",children:"directives"})," that resolve the data. Use ",(0,a.jsx)(t.a,{href:"https://tailcall.run/docs/graphql-resolver-context-tailcall/#value",children:(0,a.jsx)(t.code,{children:"{{.value}}"})})," to access the fields that act as a federation ",(0,a.jsx)(t.code,{children:"@key"})," and will be provided by the Federation Router when making the request to this subgraph."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-graphql",children:'type Post\n  @http(\n    url: "https://jsonplaceholder.typicode.com/posts"\n    query: [{key: "id", value: "{{.value.id}}"}]\n  ) {\n  id: Int!\n  userId: Int!\n  title: String!\n  body: String!\n}\n'})}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.p,{children:["Please, note that you don't need to specify the ",(0,a.jsx)(t.code,{children:"@key"})," directive manually when defining entity resolver with Tailcall. It's because Tailcall can automatically infer the key definitions from the usage of the resolver itself."]})}),"\n",(0,a.jsx)(t.h2,{id:"enable-federation-in-the-tailcall-config",children:"Enable federation in the Tailcall config"}),"\n",(0,a.jsxs)(t.p,{children:["Federation is controlled by the flag ",(0,a.jsx)(t.a,{href:"/docs/tailcall-dsl-graphql-custom-directives#enablefederation",children:(0,a.jsx)(t.code,{children:"enableFederation"})}),". Define it with ",(0,a.jsx)(t.code,{children:"true"})," value to enable federation support."]}),"\n",(0,a.jsx)(t.h2,{id:"register-your-subgraph",children:"Register your subgraph"}),"\n",(0,a.jsx)(t.p,{children:"Registration of the subgraph depends on what Federation Router you use."}),"\n",(0,a.jsx)(t.h3,{id:"graphos-router",children:"GraphOS Router"}),"\n",(0,a.jsxs)(t.p,{children:["For the ",(0,a.jsx)(t.strong,{children:"GraphOS Router"})," please refer to the ",(0,a.jsx)(t.a,{href:"https://www.apollographql.com/docs/graphos/quickstart/cloud",children:"GraphOS documentation"}),". Please note that currently, to fetch subgraph schema from Tailcall instance, you need to use introspection request with the Rover cli instead of providing the Tailcall config as the subgraph schema."]}),"\n",(0,a.jsxs)(t.p,{children:["When developing locally, use ",(0,a.jsx)(t.a,{href:"https://www.apollographql.com/docs/rover/",children:"Rover CLI"})," to start the development environment:"]}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:["Start the tailcall server as usual with ",(0,a.jsx)(t.code,{children:"tailcall start"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["Register the subgraph using introspection with ",(0,a.jsx)(t.code,{children:"rover dev --url http://localhost:8001/graphql --name post"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["Go to ",(0,a.jsx)(t.code,{children:"http://localhost:4000"})," to inspect the router schema."]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"apollogateway",children:"@apollo/gateway"}),"\n",(0,a.jsxs)(t.p,{children:["When using ",(0,a.jsx)(t.a,{href:"https://www.apollographql.com/docs/apollo-server/using-federation/api/apollo-gateway/",children:(0,a.jsx)(t.code,{children:"@apollo/gateway"})})," package, you need to specify the URLs to your subgraphs in order to register them."]}),"\n",(0,a.jsxs)(t.p,{children:["Example of ",(0,a.jsx)(t.code,{children:"@apollo/gateway"})," configuration:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",children:'import {ApolloServer} from "@apollo/server"\nimport {startStandaloneServer} from "@apollo/server/standalone"\nimport {\n  ApolloGateway,\n  IntrospectAndCompose,\n} from "@apollo/gateway"\n\nconst gateway = new ApolloGateway({\n  supergraphSdl: new IntrospectAndCompose({\n    subgraphs: [\n      {name: "post", url: "http://localhost:8001/graphql"},\n      {name: "user", url: "http://localhost:8002/graphql"},\n    ],\n  }),\n})\n\nconst server = new ApolloServer({\n  gateway,\n  introspection: true,\n})\n\nconst {url} = await startStandaloneServer(server)\nconsole.log(`\ud83d\ude80  Server ready at ${url}`)\n'})}),"\n",(0,a.jsx)(t.h2,{id:"using-federation-specific-directives",children:"Using federation specific directives"}),"\n",(0,a.jsxs)(t.p,{children:["The Federation specification defines ",(0,a.jsx)(t.a,{href:"https://www.apollographql.com/docs/federation/federated-schemas/federated-directives",children:"multiple directives"})," that control how the data is resolved. While the ",(0,a.jsx)(t.code,{children:"@key"})," directive is not necessary to be specified, any other directives should be specified the same way as in any other federation subgraph schema."]}),"\n",(0,a.jsx)(t.p,{children:"Example of using federation directives in the Tailcall config:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-graphql",children:'type User\n  @http(\n    url: "https://jsonplaceholder.typicode.com/users/{{.args.id}}"\n  )\n  @shareable {\n  id: Int!\n  name: String!\n}\n\ntype Post\n  @expr(\n    body: {\n      id: "{{.value.id}}"\n      title: "post-title-{{.value.id}}"\n    }\n  ) {\n  id: Int!\n  title: String! @override(from: "name")\n}\n'})})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>l});var a=n(96540);const o={},r=a.createContext(o);function i(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);