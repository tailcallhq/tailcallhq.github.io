name: Articles Publisher

on:
  pull_request:
    types: [closed]

env:
  HASHNODE_API_TOKEN: ${{ secrets.HASHNODE_API_TOKEN }}
  HASHNODE_PUBLICATION_ID: ${{ secrets.HASHNODE_PUBLICATION_ID }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  BRANCH_NAME: "develop"

jobs:
  article-publisher:
    if: github.event.pull_request.merged == true && github.event.pull_request.base.ref == 'develop'
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3

      - name: set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "20"

      - name: install deps and build
        run: |
          cd ./publisher
          npm install
          npm run build

      - name: run publisher
        run: |
          node ./publish_articles.js

      - name: (AUTO COMMIT) Commit and Push changes
        uses: mikeal/publish-to-github-action@master
